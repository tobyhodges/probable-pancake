<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Introduction to High-Performance Computing: Running a parallel job</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav carpentries"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="cp-logo" alt="Lesson Description" src="assets/images/carpentries-logo.svg"><span class="badge text-bg-warning">
          <abbr title="This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#field-testing-alpha-stage" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-triangle" style="border-radius: 5px"></i>
              Alpha
            </a>
            <span class="visually-hidden">This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/17-parallel.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav carpentries" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="assets/images/carpentries-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Introduction to High-Performance Computing
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Introduction to High-Performance Computing
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="discuss.html">Taking Your Next Steps</a></li><li><a class="dropdown-item" href="reference.html">Knowledge Base</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to High-Performance Computing
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 65%" class="percentage">
    65%
  </div>
  <div class="progress carpentries">
    <div class="progress-bar carpentries" role="progressbar" style="width: 65%" aria-valuenow="65" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/17-parallel.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="10-hpc-intro.html">1. Why use a Cluster?</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="11-connecting.html">2. Connecting to a remote HPC system</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="12-cluster.html">3. Exploring Remote Resources</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="13-scheduler.html">4. Scheduler Fundamentals</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="14-environment-variables.html">5. Environment Variables</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="15-modules.html">6. Accessing software via Modules</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="16-transferring-files.html">7. Transferring files with remote computers</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        8. Running a parallel job
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#install-the-amdahl-program">Install the Amdahl Program</a></li>
<li><a href="#help">Help!</a></li>
<li><a href="#running-the-job-on-a-compute-node">Running the Job on a Compute Node</a></li>
<li><a href="#running-the-parallel-job">Running the Parallel Job</a></li>
<li><a href="#how-much-does-parallel-execution-improve-performance">How Much Does Parallel Execution Improve Performance?</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="18-resources.html">9. Using resources effectively</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="19-responsibility.html">10. Using shared resources responsibly</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="discuss.html">Taking Your Next Steps</a></li><li><a href="reference.html">Knowledge Base</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="16-transferring-files.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="18-resources.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="16-transferring-files.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Transferring files
        </a>
        <a class="chapter-link float-end" href="18-resources.html" rel="next">
          Next: Using resources...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Running a parallel job</h1>
        <p>Last updated on 2024-09-26 |

        <a href="https://github.com/tobyhodges/probable-pancake/edit/main/episodes/17-parallel.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do we execute a task in parallel?</li>
<li>What benefits arise from parallel execution?</li>
<li>What are the limits of gains from execution in parallel?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Install a Python package using <code>pip</code>
</li>
<li>Prepare a job submission script for the parallel executable.</li>
<li>Launch jobs with parallel execution.</li>
<li>Record and summarize the timing and accuracy of jobs.</li>
<li>Describe the relationship between job parallelism and
performance.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>We now have the tools we need to run a multi-processor job. This is a
very important aspect of HPC systems, as parallelism is one of the
primary tools we have to improve the performance of computational
tasks.</p>
<p>If you disconnected, log back in to the cluster.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">{{</span> site.local.prompt }} ssh {{ site.remote.user }}@{{ site.remote.login }}</span></code></pre>
</div>
<section><h2 class="section-heading" id="install-the-amdahl-program">Install the Amdahl Program<a class="anchor" aria-label="anchor" href="#install-the-amdahl-program"></a></h2>
<hr class="half-width"><p>With the Amdahl source code on the cluster, we can install it, which
will provide access to the <code>amdahl</code> executable. Move into the
extracted directory, then use the Package Installer for Python, or
<code>pip</code>, to install it in your (“user”) home directory:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} cd amdahl</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} python3 <span class="at">-m</span> pip install <span class="at">--user</span> .</span></code></pre>
</div>
<div id="amdahl-is-python-code" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="amdahl-is-python-code" class="callout-inner">
<h3 class="callout-title">Amdahl is Python Code</h3>
<div class="callout-content">
<p>The Amdahl program is written in Python, and installing or using it
requires locating the <code>python3</code> executable on the login node.
If it can’t be found, try listing available modules using
<code>module avail</code>, load the appropriate one, and try the command
again.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="mpi-for-python">MPI for Python<a class="anchor" aria-label="anchor" href="#mpi-for-python"></a></h3>
<p>The Amdahl code has one dependency: <strong>mpi4py</strong>. If it
hasn’t already been installed on the cluster, <code>pip</code> will
attempt to collect mpi4py from the Internet and install it for you. If
this fails due to a one-way firewall, you must retrieve mpi4py on your
local machine and upload it, just as we did for Amdahl.</p>
<div id="retrieve-and-upload-mpi4py" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="retrieve-and-upload-mpi4py" class="callout-inner">
<h3 class="callout-title">Retrieve and Upload <code>mpi4py</code>
</h3>
<div class="callout-content">
<p>If installing Amdahl failed because mpi4py could not be installed,
retrieve the tarball from <a href="https://github.com/mpi4py/mpi4py/tarball/master" class="external-link uri">https://github.com/mpi4py/mpi4py/tarball/master</a> then
<code>rsync</code> it to the cluster, extract, and install:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">{{</span> site.local.prompt }} wget <span class="at">-O</span> mpi4py.tar.gz https://github.com/mpi4py/mpi4py/releases/download/3.1.4/mpi4py-3.1.4.tar.gz</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">{{</span> site.local.prompt }} scp mpi4py.tar.gz {{ site.remote.user }}@{{ site.remote.login }}:</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="ex">{{</span> site.local.prompt }} rsync <span class="at">-avP</span> mpi4py.tar.gz {{ site.remote.user }}@{{ site.remote.login }}:</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">{{</span> site.local.prompt }} ssh {{ site.remote.user }}@{{ site.remote.login }}</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} tar <span class="at">-xvzf</span> mpi4py.tar.gz  <span class="co"># extract the archive</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} mv mpi4py<span class="pp">*</span> mpi4py        <span class="co"># rename the directory</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} cd mpi4py</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} python3 <span class="at">-m</span> pip install <span class="at">--user</span> .</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} cd ../amdahl</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} python3 <span class="at">-m</span> pip install <span class="at">--user</span> .</span></code></pre>
</div>
</div>
</div>
</div>
<div id="if-pip-raises-a-warning" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="if-pip-raises-a-warning" class="callout-inner">
<h3 class="callout-title">If <code>pip</code> Raises a Warning…</h3>
<div class="callout-content">
<p><code>pip</code> may warn that your user package binaries are not in
your PATH.</p>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>WARNING: The script amdahl is installed in "${HOME}/.local/bin" which is
not on PATH. Consider adding this directory to PATH or, if you prefer to
suppress this warning, use --no-warn-script-location.</code></pre>
</div>
<p>To check whether this warning is a problem, use <code>which</code> to
search for the <code>amdahl</code> program:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} which amdahl</span></code></pre>
</div>
<p>If the command returns no output, displaying a new prompt, it means
the file <code>amdahl</code> has not been found. You must update the
environment variable named <code>PATH</code> to include the missing
folder. Edit your shell configuration file as follows, then log off the
cluster and back on again so it takes effect.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} nano ~/.bashrc</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} tail ~/.bashrc</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>export PATH=${PATH}:${HOME}/.local/bin</code></pre>
</div>
<p>After logging back in to {{ site.remote.login }}, <code>which</code>
should be able to find <code>amdahl</code> without difficulties. If you
had to load a Python module, load it again.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="help">Help!<a class="anchor" aria-label="anchor" href="#help"></a></h2>
<hr class="half-width"><p>Many command-line programs include a “help” message. Try it with
<code>amdahl</code>:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} amdahl <span class="at">--help</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>usage: amdahl [-h] [-p [PARALLEL_PROPORTION]] [-w [WORK_SECONDS]] [-t] [-e] [-j [JITTER_PROPORTION]]

optional arguments:
  -h, --help            show this help message and exit
  -p [PARALLEL_PROPORTION], --parallel-proportion [PARALLEL_PROPORTION]
                        Parallel proportion: a float between 0 and 1
  -w [WORK_SECONDS], --work-seconds [WORK_SECONDS]
                        Total seconds of workload: an integer greater than 0
  -t, --terse           Format output as a machine-readable object for easier analysis
  -e, --exact           Exactly match requested timing by disabling random jitter
  -j [JITTER_PROPORTION], --jitter-proportion [JITTER_PROPORTION]
                        Random jitter: a float between -1 and +1</code></pre>
</div>
<p>This message doesn’t tell us much about what the program
<em>does</em>, but it does tell us the important flags we might want to
use when launching it.</p>
</section><section><h2 class="section-heading" id="running-the-job-on-a-compute-node">Running the Job on a Compute Node<a class="anchor" aria-label="anchor" href="#running-the-job-on-a-compute-node"></a></h2>
<hr class="half-width"><p>Create a submission file, requesting one task on a single node, then
launch it.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} nano serial-job.sh</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} cat serial-job.sh</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.bash_shebang }}</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} {{ site.sched.flag.name }} solo-job</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} {{ site.sched.flag.queue }} {{ site.sched.queue.testing }}</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} <span class="at">-N</span> 1</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} <span class="at">-n</span> 1</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co"># Load the computing environment we need</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="ex">module</span> load {{ site.remote.module_python3 }}</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co"># Execute the task</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="ex">amdahl</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} {{ site.sched.submit.name }} serial-job.sh</span></code></pre>
</div>
<p>As before, use the {{ site.sched.name }} status commands to check
whether your job is running and when it ends:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} {{ site.sched.status }} {{ site.sched.flag.user }}</span></code></pre>
</div>
<p>Use <code>ls</code> to locate the output file. The <code>-t</code>
flag sorts in reverse-chronological order: newest first. What was the
output?</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Read the Job Output </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>The cluster output should be written to a file in the folder you
launched the job from. For example,</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} ls <span class="at">-t</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>slurm-347087.out  serial-job.sh  amdahl  README.md  LICENSE.txt</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} cat slurm-347087.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Doing 30.000 seconds of 'work' on 1 processor,
which should take 30.000 seconds with 0.850 parallel proportion of the workload.

  Hello, World! I am process 0 of 1 on {{ site.remote.node }}. I will do all the serial 'work' for 4.500 seconds.
  Hello, World! I am process 0 of 1 on {{ site.remote.node }}. I will do parallel 'work' for 25.500 seconds.

Total execution time (according to rank 0): 30.033 seconds</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>As we saw before, two of the <code>amdahl</code> program flags set
the amount of work and the proportion of that work that is parallel in
nature. Based on the output, we can see that the code uses a default of
30 seconds of work that is 85% parallel. The program ran for just over
30 seconds in total, and if we run the numbers, it is true that 15% of
it was marked ‘serial’ and 85% was ‘parallel’.</p>
<p>Since we only gave the job one CPU, this job wasn’t really parallel:
the same processor performed the ‘serial’ work for 4.5 seconds, then the
‘parallel’ part for 25.5 seconds, and no time was saved. The cluster can
do better, if we ask.</p>
</section><section><h2 class="section-heading" id="running-the-parallel-job">Running the Parallel Job<a class="anchor" aria-label="anchor" href="#running-the-parallel-job"></a></h2>
<hr class="half-width"><p>The <code>amdahl</code> program uses the Message Passing Interface
(MPI) for parallelism -- this is a common tool on HPC systems.</p>
<div id="what-is-mpi" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="what-is-mpi" class="callout-inner">
<h3 class="callout-title">What is MPI?</h3>
<div class="callout-content">
<p>The Message Passing Interface is a set of tools which allow multiple
tasks running simultaneously to communicate with each other. Typically,
a single executable is run multiple times, possibly on different
machines, and the MPI tools are used to inform each instance of the
executable about its sibling processes, and which instance it is. MPI
also provides tools to allow communication between instances to
coordinate work, exchange information about elements of the task, or to
transfer data. An MPI instance typically has its own copy of all the
local variables.</p>
</div>
</div>
</div>
<p>While MPI-aware executables can generally be run as stand-alone
programs, in order for them to run in parallel they must use an MPI
<em>run-time environment</em>, which is a specific implementation of the
MPI <em>standard</em>. To activate the MPI environment, the program
should be started via a command such as <code>mpiexec</code> (or
<code>mpirun</code>, or <code>srun</code>, etc. depending on the MPI
run-time you need to use), which will ensure that the appropriate
run-time support for parallelism is included.</p>
<div id="mpi-runtime-arguments" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="mpi-runtime-arguments" class="callout-inner">
<h3 class="callout-title">MPI Runtime Arguments</h3>
<div class="callout-content">
<p>On their own, commands such as <code>mpiexec</code> can take many
arguments specifying how many machines will participate in the
execution, and you might need these if you would like to run an MPI
program on your own (for example, on your laptop). In the context of a
queuing system, however, it is frequently the case that MPI run-time
will obtain the necessary parameters from the queuing system, by
examining the environment variables set when the job is launched.</p>
</div>
</div>
</div>
<p>Let’s modify the job script to request more cores and use the MPI
run-time.</p>
<p><code>bash, bash {{ site.remote.prompt }} cp serial-job.sh parallel-job.sh {{ site.remote.prompt }} nano parallel-job.sh {{ site.remote.prompt }} cat parallel-job.sh</code></p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.bash_shebang }}</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} {{ site.sched.flag.name }} parallel-job</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} {{ site.sched.flag.queue }} {{ site.sched.queue.testing }}</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} <span class="at">-N</span> 1</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} <span class="at">-n</span> 4</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co"># Load the computing environment we need</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co"># (mpi4py and numpy are in SciPy-bundle)</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="ex">module</span> load {{ site.remote.module_python3 }}</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="ex">module</span> load SciPy-bundle</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co"># Execute the task</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="ex">mpiexec</span> amdahl</span></code></pre>
</div>
<p>Then submit your job. Note that the submission command has not really
changed from how we submitted the serial job: all the parallel settings
are in the batch file rather than the command line.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} {{ site.sched.submit.name }} parallel-job.sh</span></code></pre>
</div>
<p>As before, use the status commands to check when your job runs.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} ls <span class="at">-t</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>slurm-347178.out  parallel-job.sh  slurm-347087.out  serial-job.sh  amdahl  README.md  LICENSE.txt</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} cat slurm-347178.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Doing 30.000 seconds of 'work' on 4 processors,
which should take 10.875 seconds with 0.850 parallel proportion of the workload.

  Hello, World! I am process 0 of 4 on {{ site.remote.node }}. I will do all the serial 'work' for 4.500 seconds.
  Hello, World! I am process 2 of 4 on {{ site.remote.node }}. I will do parallel 'work' for 6.375 seconds.
  Hello, World! I am process 1 of 4 on {{ site.remote.node }}. I will do parallel 'work' for 6.375 seconds.
  Hello, World! I am process 3 of 4 on {{ site.remote.node }}. I will do parallel 'work' for 6.375 seconds.
  Hello, World! I am process 0 of 4 on {{ site.remote.node }}. I will do parallel 'work' for 6.375 seconds.

Total execution time (according to rank 0): 10.888 seconds</code></pre>
</div>
<div id="is-it-4-faster" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="is-it-4-faster" class="callout-inner">
<h3 class="callout-title">Is it 4× faster?</h3>
<div class="callout-content">
<p>The parallel job received 4× more processors than the serial job:
does that mean it finished in ¼ the time?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The parallel job did take <em>less</em> time: 11 seconds is better
than 30! But it is only a 2.7× improvement, not 4×.</p>
<p>Look at the job output:</p>
<ul><li>While “process 0” did serial work, processes 1 through 3 did their
parallel work.</li>
<li>While process 0 caught up on its parallel work, the rest did nothing
at all.</li>
</ul><p>Process 0 always has to finish its serial task before it can start on
the parallel work. This sets a lower limit on the amount of time this
job will take, no matter how many cores you throw at it.</p>
<p>This is the basic principle behind <a href="https://en.wikipedia.org/wiki/Amdahl's_law" class="external-link">Amdahl’s Law</a>,
which is one way of predicting improvements in execution time for a
<strong>fixed</strong> workload that can be subdivided and run in
parallel to some extent.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="how-much-does-parallel-execution-improve-performance">How Much Does Parallel Execution Improve Performance?<a class="anchor" aria-label="anchor" href="#how-much-does-parallel-execution-improve-performance"></a></h2>
<hr class="half-width"><p>In theory, dividing up a perfectly parallel calculation among
<em>n</em> MPI processes should produce a decrease in total run time by
a factor of <em>n</em>. As we have just seen, real programs need some
time for the MPI processes to communicate and coordinate, and some types
of calculations can’t be subdivided: they only run effectively on a
single CPU.</p>
<p>Additionally, if the MPI processes operate on different physical CPUs
in the computer, or across multiple compute nodes, even more time is
required for communication than it takes when all processes operate on a
single CPU.</p>
<p>In practice, it’s common to evaluate the parallelism of an MPI
program by</p>
<ul><li>running the program across a range of CPU counts,</li>
<li>recording the execution time on each run,</li>
<li>comparing each execution time to the time when using a single
CPU.</li>
</ul><p>Since “more is better” – improvement is easier to interpret from
increases in some quantity than decreases – comparisons are made using
the speedup factor <em>S</em>, which is calculated as the single-CPU
execution time divided by the multi-CPU execution time. For a perfectly
parallel program, a plot of the speedup <em>S</em> versus the number of
CPUs <em>n</em> would give a straight line, <em>S</em> = <em>n</em>.</p>
<p>Let’s run one more job, so we can see how close to a straight line
our <code>amdahl</code> code gets.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} nano parallel-job.sh</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} cat parallel-job.sh</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.bash_shebang }}</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} {{ site.sched.flag.name }} parallel-job</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} {{ site.sched.flag.queue }} {{ site.sched.queue.testing }}</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} <span class="at">-N</span> 1</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="ex">{{</span> site.sched.comment }} <span class="at">-n</span> 8</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="co"># Load the computing environment we need</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="co"># (mpi4py and numpy are in SciPy-bundle)</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a><span class="ex">module</span> load {{ site.remote.module_python3 }}</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a><span class="ex">module</span> load SciPy-bundle</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a><span class="co"># Execute the task</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a><span class="ex">mpiexec</span> amdahl</span></code></pre>
</div>
<p>Then submit your job. Note that the submission command has not really
changed from how we submitted the serial job: all the parallel settings
are in the batch file rather than the command line.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} {{ site.sched.submit.name }} parallel-job.sh</span></code></pre>
</div>
<p>As before, use the status commands to check when your job runs.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} ls <span class="at">-t</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>slurm-347271.out  parallel-job.sh  slurm-347178.out  slurm-347087.out  serial-job.sh  amdahl  README.md  LICENSE.txt</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} cat slurm-347178.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>which should take 7.688 seconds with 0.850 parallel proportion of the workload.

  Hello, World! I am process 4 of 8 on {{ site.remote.node }}. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 0 of 8 on {{ site.remote.node }}. I will do all the serial 'work' for 4.500 seconds.
  Hello, World! I am process 2 of 8 on {{ site.remote.node }}. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 1 of 8 on {{ site.remote.node }}. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 3 of 8 on {{ site.remote.node }}. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 5 of 8 on {{ site.remote.node }}. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 6 of 8 on {{ site.remote.node }}. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 7 of 8 on {{ site.remote.node }}. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 0 of 8 on {{ site.remote.node }}. I will do parallel 'work' for 3.188 seconds.

Total execution time (according to rank 0): 7.697 seconds</code></pre>
</div>
<div id="non-linear-output" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="non-linear-output" class="callout-inner">
<h3 class="callout-title">Non-Linear Output</h3>
<div class="callout-content">
<p>When we ran the job with 4 parallel workers, the serial job wrote its
output first, then the parallel processes wrote their output, with
process 0 coming in first and last.</p>
<p>With 8 workers, this is not the case: since the parallel workers take
less time than the serial work, it is hard to say which process will
write its output first, except that it will <em>not</em> be process
0!</p>
</div>
</div>
</div>
<p>Now, let’s summarize the amount of time it took each job to run:</p>
<table class="table"><thead><tr class="header"><th>Number of CPUs</th>
<th>Runtime (sec)</th>
</tr></thead><tbody><tr class="odd"><td>1</td>
<td>30.033</td>
</tr><tr class="even"><td>4</td>
<td>10.888</td>
</tr><tr class="odd"><td>8</td>
<td>7.697</td>
</tr></tbody></table><p>Then, use the first row to compute speedups <em>S</em>, using Python
as a command-line calculator:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="ex">{{</span> site.remote.prompt }} for n in 30.033 10.888 7.697<span class="kw">;</span> <span class="cf">do</span> <span class="ex">python3</span> <span class="at">-c</span> <span class="st">"print(30.033 / </span><span class="va">$n</span><span class="st">)"</span><span class="kw">;</span> <span class="cf">done</span></span></code></pre>
</div>
<table class="table"><thead><tr class="header"><th>Number of CPUs</th>
<th>Speedup</th>
<th>Ideal</th>
</tr></thead><tbody><tr class="odd"><td>1</td>
<td>1.0</td>
<td>1</td>
</tr><tr class="even"><td>4</td>
<td>2.75</td>
<td>4</td>
</tr><tr class="odd"><td>8</td>
<td>3.90</td>
<td>8</td>
</tr></tbody></table><p>The job output files have been telling us that this program is
performing 85% of its work in parallel, leaving 15% to run in serial.
This seems reasonably high, but our quick study of speedup shows that in
order to get a 4× speedup, we have to use 8 or 9 processors in parallel.
In real programs, the speedup factor is influenced by</p>
<ul><li>CPU design</li>
<li>communication network between compute nodes</li>
<li>MPI library implementations</li>
<li>details of the MPI program itself</li>
</ul><p>Using Amdahl’s Law, you can prove that with this program, it is
<em>impossible</em> to reach 8× speedup, no matter how many processors
you have on hand. Details of that analysis, with results to back it up,
are left for the next class in the HPC Carpentry workshop, <em>HPC
Workflows</em>.</p>
<p>In an HPC environment, we try to reduce the execution time for all
types of jobs, and MPI is an extremely common way to combine dozens,
hundreds, or thousands of CPUs into solving a single problem. To learn
more about parallelization, see the <a href="https://www.hpc-carpentry.org/hpc-parallel-novice/" class="external-link">parallel
novice lesson</a> lesson.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Parallel programming allows applications to take advantage of
parallel hardware.</li>
<li>The queuing system facilitates executing parallel tasks.</li>
<li>Performance improvements from parallel execution do not scale
linearly.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="16-transferring-files.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="18-resources.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="16-transferring-files.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Transferring files
        </a>
        <a class="chapter-link float-end" href="18-resources.html" rel="next">
          Next: Using resources...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/tobyhodges/probable-pancake/edit/main/episodes/17-parallel.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/tobyhodges/probable-pancake/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/tobyhodges/probable-pancake/" class="external-link">Source</a></p>
				<p><a href="https://github.com/tobyhodges/probable-pancake/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.7" class="external-link">sandpaper (0.16.7)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.4" class="external-link">varnish (1.0.4)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://tkphd.github.io/hpc-intro-online/17-parallel.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Running a parallel job",
  "creativeWorkStatus": "active",
  "url": "https://tkphd.github.io/hpc-intro-online/17-parallel.html",
  "identifier": "https://tkphd.github.io/hpc-intro-online/17-parallel.html",
  "dateCreated": "2017-03-24",
  "dateModified": "2024-09-26",
  "datePublished": "2024-10-08"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

